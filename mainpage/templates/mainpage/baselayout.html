{% load static %}
{% load bootstrap4 %}
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        {% bootstrap_css %}
        <link rel="stylesheet" href="{% static 'mainpage/style.css' %}">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
        <title>Строительная Компания</title>
    </head>
    <body>
        {% block menu %}
        <header>
            <nav class="navbar">
                <a href="{% url 'home' %}">
                    <img src="{% static 'mainpage/images/NewLogo.png' %}" alt="Логотип" class="navbar-logo">
                </a>

                <div class="navbar-container">
                    <!-- Левая часть меню -->
                    <ul class="navbar-menu navbar-menu-left">
                        <li><a href="{% url 'home' %}">Главная</a></li>
                        <li><a href="{% url 'services' %}">Услуги</a></li>
                        <li><a href="{% url 'projects' %}">Проекты</a></li>
                        <li><a href="{% url 'about' %}">О нас</a></li>
                        <li><a href="{% url 'contact' %}">Контакты</a></li>
                    </ul>

                    <ul class="navbar-menu navbar-menu-right">
                        {% if user.is_authenticated %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-expanded="false">
                                    {{ user.username }}
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <a class="dropdown-item" href="#" >Профиль</a>
                                    <a class="dropdown-item" href="#">Настройки</a>
                                    <a class="dropdown-item" href="{% url 'create_project' %}">Создать проект</a>
                                    <a class="dropdown-item" href="#">Обратная связь</a>
                                    <div class="dropdown-divider"></div>
                                    <form action="{% url 'logout' %}" method="post" class="px-2 py-1">
                                        {% csrf_token %}
                                        <button type="submit" class="dropdown-item btn btn-link p-0 text-start" style="width: 100%;">
                                            Выйти
                                        </button>
                                    </form>
                                </div>
                            </li>
                        {% else %}
                            <li><a href="{% url 'login' %}">Войти</a></li>
                            <li><a href="{% url 'register_client' %}">Регистрация</a></li>
                        {% endif %}
                    </ul>
                </div>
            </nav>
        </header>
        {% endblock %}

        {% block content %}
        {% endblock %}

        {% include 'mainpage/footer.html' %}

        <!-- Подключаем jQuery, Popper.js и Bootstrap JS -->
        {% bootstrap_javascript jquery='full' %}

        <script>
        // Функция для получения CSRF токена
        function getCSRFToken() {
            let cookieValue = null;
            const name = 'csrftoken';
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Инициализация dropdown вручную для Bootstrap 4
        $(document).ready(function(){
            $('.dropdown-toggle').dropdown();
        });
        </script>
    </body>
</html>